﻿
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - KartverketRegister</title>
    <script type="importmap"></script>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/KartverketRegister.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/dark-mode.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/WelcomeToCompleteDarkness.css" asp-append-version="true" />
  
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3" id="topmeny">
            <div class="container-fluid">
                <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index">KartverketRegister</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                    <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
                     <!-- LEFT-SIDE NAVIGATION ITEMS -->
                <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
                    <!-- LEFT-SIDE NAVIGATION ITEMS -->
                    <ul class="navbar-nav flex-grow-1">
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-area="" asp-controller="Flightmode" asp-action="Index">FlightMode</a>
                        </li>
                
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Registry">Registry</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-area="" asp-controller="Admin" asp-action="Index">Admin</a>
                        </li>
                    </ul>
                    <ul>
                    </ul>
                    <!-- RIGHT-SIDE NAVIGATION ITEM  -->
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <div class="btn-group" role="group" aria-label="Basic example">
                                <button type="button" class="btn btn-primary" id="Light_btn">light</button>
                                <button type="button" class="btn btn-primary" id="Dark_btn">Dark</button>
                            </div>
                        </li>
                            <li class="nav-item">
                                <div class="btn-group" role="group" aria-label=" k">
                                    <button type="button" class="btn btn-primary" onclick="dms(false)">light v2</button>
                                    <button type="button" class="btn btn-primary" onclick="dms(true)">Dark v2</button>
                                </div>
                            </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="User" >User</a>

                        </li>
                        <li class="nav-item" id="resetdbbutton" style="background-color:darkred;color:white">
                            <a class="nav-link text-dark" onclick="resetdb()">RESET DATABASE</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="container">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="https://apifreellm.com/apifree.min.js"></script>
    <script src="/js/Dark-mode.js"></script>
    <script>
                const prompts = [
            "Write a quirky one-sentence 'Are you sure?' message for a HARD RESET. " +
            "End it with a keyword wrapped in *asterisks* (like *YES* or *PURGE*, *etc*). " +
            "Tell the user to type that keyword to confirm.",
            "Give me an unusual 'Are you sure' message, one sentence long, its to make sure user wants to HARD RESET database, end it with a phase type 'true, yes, accept, positive, etc', Keep the phase in * instead of quotes! and tell userto type it!"

        ]

        function dms(bool) {
            let body = document.querySelector('body')
            let mappyUwU = document.getElementById("map")
            

            if (bool) {
                sessionStorage.setItem('DarkMode', true);
                body.classList.add("MayDarknessSwallowYourSoul")
                mappyUwU.classList.add("MayDarknessSwallowYourSoulMap")
            } else {
                sessionStorage.setItem('DarkMode', false);
                body.classList.remove("MayDarknessSwallowYourSoul")
                mappyUwU.classList.remove("MayDarknessSwallowYourSoulMap")
            }
        }

        const rdbbut = document.getElementById('resetdbbutton');
        let msgin = null;
        async function setMsginToAi() {
            console.log('[AI-MSG] Fetching AI message from the tactical AI source!')
            if (msgin == null) {
                try {

                    msgin = await ApiFreeLLM.chat(prompts[0]);
                    console.log('[AI-MSG] Confirmation string generated successfully');
                    rdbbut.style.backgroundColor = 'lightblue';

                } catch {
                    console.log('[AI-MSG] Failed to fetch tactical message, Trying again!');
                    await setMsginToAi();
                }
            }
        }
        setTimeout(async ()=>{await setMsginToAi()},1000)
        setTimeout(()=>{dms(sessionStorage.getItem('DarkMode') === 'true')},1);



        async function resetdb() {
            if (msgin == null) {
                msgin = "Are you sure you want to delete and reset the WHOLE database? Type *yes* to continue...";
            }

            let rightpin = findKeyWord(msgin);
            console.log(rightpin);
            let pin = prompt(msgin);
            console.log(msgin);
            console.log(pin);


            if (pin.toLowerCase() == rightpin.toLowerCase()) {
                fetch("/admin/ResetDB");
                alert("Ok db resetted!");
            } else {
                alert("Ok, nah no reset today!");
            }

        }
        function findKeyWord(aiFeedback) {
            split = aiFeedback.split("*").map((words) => { return words.split(" ") }).filter((a) => a.length == 1 && a[0].length >= 3);
            return split[split.length - 1][0];
        }


    </script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>