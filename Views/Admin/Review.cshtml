@{
    ViewData["Title"] = "Review Marker";
}

<h2>Review Marker</h2>

<!-- Her vises marker-detaljer -->
<div id="marker-info" style="margin-bottom: 20px;">
    <p><b>Name:</b> <span id="marker-name"></span></p>
    <p><b>Description:</b> <span id="marker-description"></span></p>
    <p><b>Latitude:</b> <span id="marker-lat"></span></p>
    <p><b>Longitude:</b> <span id="marker-lng"></span></p>
</div>

<!-- Felt for kommentar -->
<div style="margin-bottom: 20px;">
    <label for="review-comment"><b>Review comment:</b></label><br />
    <textarea id="review-comment" rows="4" cols="50" placeholder="Write your review here..."></textarea>
</div>

<!-- Knapper -->
<button id="accept-btn">Accept</button>
<button id="reject-btn">Reject</button>

<!-- JavaScript -->
<script>
    // 1️⃣ Hent MarkerId fra URL
    const urlParams = new URLSearchParams(window.location.search);
    const markerId = urlParams.get("MarkerId");

    // 2️⃣ Hent marker-data fra server
    async function fetchMarker(markerId) {
        const response = await fetch(`/Admin/GetMarkerInfo?MarkerId=${markerId}`);
        if (!response.ok) {
            console.error("Kunne ikke hente marker-info.");
            return;
        }

        const data = await response.json();

        // 3️⃣ Fyll inn info på siden
        document.getElementById("marker-name").textContent = data.name;
        document.getElementById("marker-description").textContent = data.description;
        document.getElementById("marker-lat").textContent = data.lat;
        document.getElementById("marker-lng").textContent = data.lng;
    }

    fetchMarker(markerId);

    // 4️⃣ Knappefunksjoner
    document.getElementById("accept-btn").addEventListener("click", () => sendReview("accepted"));
    document.getElementById("reject-btn").addEventListener("click", () => sendReview("rejected"));

    // 5️⃣ Send kommentar og status tilbake til server
    async function sendReview(status) {
        const comment = document.getElementById("review-comment").value;

        const response = await fetch('/Admin/SubmitReview', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                markerId: markerId,
                comment: comment,
                status: status
            })
        });

        if (response.ok) {
            alert(`Marker ${status}!`);
            window.location.href = "/Admin/Index"; // send tilbake til hovedsiden
        } else {
            alert("Noe gikk galt ved innsending.");
        }
    }
</script>
